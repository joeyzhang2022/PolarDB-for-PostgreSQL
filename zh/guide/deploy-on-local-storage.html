<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/PolarDB-for-PostgreSQL/favicon.ico"><title>实例部署：基于单机本地存储 | PolarDB for PostgreSQL</title><meta name="description" content="阿里云自主研发的云原生数据库产品">
    <link rel="modulepreload" href="/PolarDB-for-PostgreSQL/assets/app.9be17b95.js"><link rel="modulepreload" href="/PolarDB-for-PostgreSQL/assets/deploy-on-local-storage.html.47c6a186.js"><link rel="modulepreload" href="/PolarDB-for-PostgreSQL/assets/deploy-on-local-storage.html.c5332d5a.js"><link rel="modulepreload" href="/PolarDB-for-PostgreSQL/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/PolarDB-for-PostgreSQL/assets/style.f746e56a.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/PolarDB-for-PostgreSQL/zh/" class=""><img class="logo" src="/PolarDB-for-PostgreSQL/images/polardb.png" alt="PolarDB for PostgreSQL"><span class="site-name can-hide">PolarDB for PostgreSQL</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/PolarDB-for-PostgreSQL/zh/guide/" class="router-link-active" aria-label="快速上手"><!--[--><!--]--> 快速上手 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="架构解读"><span class="title">架构解读</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="架构解读"><span class="title">架构解读</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/architecture/" class="" aria-label="架构详解"><!--[--><!--]--> 架构详解 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/architecture/buffer-management.html" class="" aria-label="缓冲区管理"><!--[--><!--]--> 缓冲区管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/architecture/ddl-synchronization.html" class="" aria-label="DDL 同步"><!--[--><!--]--> DDL 同步 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/architecture/logindex.html" class="" aria-label="LogIndex"><!--[--><!--]--> LogIndex <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/PolarDB-for-PostgreSQL/zh/roadmap/" class="" aria-label="版本规划"><!--[--><!--]--> 版本规划 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="参与社区"><span class="title">参与社区</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="参与社区"><span class="title">参与社区</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/contributing/contributing-polardb-kernel.html" class="" aria-label="贡献代码"><!--[--><!--]--> 贡献代码 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/contributing/contributing-polardb-docs.html" class="" aria-label="贡献文档"><!--[--><!--]--> 贡献文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/contributing/coding-style.html" class="" aria-label="编码风格"><!--[--><!--]--> 编码风格 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/contributing/code-of-conduct.html" class="" aria-label="行为准则"><!--[--><!--]--> 行为准则 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="选择语言"><span class="title">选择语言</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="选择语言"><span class="title">选择语言</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/guide/deploy-on-local-storage.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html" class="router-link-active router-link-exact-active router-link-active" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/PolarDB-for-PostgreSQL/zh/guide/" class="router-link-active" aria-label="快速上手"><!--[--><!--]--> 快速上手 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="架构解读"><span class="title">架构解读</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="架构解读"><span class="title">架构解读</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/architecture/" class="" aria-label="架构详解"><!--[--><!--]--> 架构详解 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/architecture/buffer-management.html" class="" aria-label="缓冲区管理"><!--[--><!--]--> 缓冲区管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/architecture/ddl-synchronization.html" class="" aria-label="DDL 同步"><!--[--><!--]--> DDL 同步 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/architecture/logindex.html" class="" aria-label="LogIndex"><!--[--><!--]--> LogIndex <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/PolarDB-for-PostgreSQL/zh/roadmap/" class="" aria-label="版本规划"><!--[--><!--]--> 版本规划 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="参与社区"><span class="title">参与社区</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="参与社区"><span class="title">参与社区</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/contributing/contributing-polardb-kernel.html" class="" aria-label="贡献代码"><!--[--><!--]--> 贡献代码 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/contributing/contributing-polardb-docs.html" class="" aria-label="贡献文档"><!--[--><!--]--> 贡献文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/contributing/coding-style.html" class="" aria-label="编码风格"><!--[--><!--]--> 编码风格 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/contributing/code-of-conduct.html" class="" aria-label="行为准则"><!--[--><!--]--> 行为准则 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="选择语言"><span class="title">选择语言</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="选择语言"><span class="title">选择语言</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/guide/deploy-on-local-storage.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html" class="router-link-active router-link-exact-active router-link-active" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">快速上手 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/PolarDB-for-PostgreSQL/zh/guide/" class="router-link-active sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-cloud.html" class="sidebar-item" aria-label="实例部署：基于阿里巴巴云服务"><!--[--><!--]--> 实例部署：基于阿里巴巴云服务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="实例部署：基于单机本地存储"><!--[--><!--]--> 实例部署：基于单机本地存储 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#安装-docker" class="router-link-active router-link-exact-active sidebar-item" aria-label="安装 Docker"><!--[--><!--]--> 安装 Docker <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#编译环境准备" class="router-link-active router-link-exact-active sidebar-item" aria-label="编译环境准备"><!--[--><!--]--> 编译环境准备 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#基于-polardb-docker-开发镜像" class="router-link-active router-link-exact-active sidebar-item" aria-label="基于 PolarDB Docker 开发镜像"><!--[--><!--]--> 基于 PolarDB Docker 开发镜像 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#基于-centos-7-系统或容器" class="router-link-active router-link-exact-active sidebar-item" aria-label="基于 CentOS 7 系统或容器"><!--[--><!--]--> 基于 CentOS 7 系统或容器 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#编译实例类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="编译实例类型"><!--[--><!--]--> 编译实例类型 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#本地单节点实例" class="router-link-active router-link-exact-active sidebar-item" aria-label="本地单节点实例"><!--[--><!--]--> 本地单节点实例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#本地多节点实例" class="router-link-active router-link-exact-active sidebar-item" aria-label="本地多节点实例"><!--[--><!--]--> 本地多节点实例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#本地多节点带备库实例" class="router-link-active router-link-exact-active sidebar-item" aria-label="本地多节点带备库实例"><!--[--><!--]--> 本地多节点带备库实例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#本地多节点-htap-实例" class="router-link-active router-link-exact-active sidebar-item" aria-label="本地多节点 HTAP 实例"><!--[--><!--]--> 本地多节点 HTAP 实例 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#实例回归测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="实例回归测试"><!--[--><!--]--> 实例回归测试 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-nbd-shared-storage.html" class="sidebar-item" aria-label="实例部署：基于 NBD 共享存储"><!--[--><!--]--> 实例部署：基于 NBD 共享存储 <!--[--><!--]--></a><!----></li><li><a href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-ceph-shared-storage.html" class="sidebar-item" aria-label="实例部署：基于 Ceph 共享存储"><!--[--><!--]--> 实例部署：基于 Ceph 共享存储 <!--[--><!--]--></a><!----></li><li><a href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-polardb-stack.html" class="sidebar-item" aria-label="实例部署：基于 PolarDB Stack 共享存储"><!--[--><!--]--> 实例部署：基于 PolarDB Stack 共享存储 <!--[--><!--]--></a><!----></li><li><a href="/PolarDB-for-PostgreSQL/zh/guide/tpch-on-px.html" class="sidebar-item" aria-label="特性实践：利用 PolarDB HTAP 加速 TPC-H"><!--[--><!--]--> 特性实践：利用 PolarDB HTAP 加速 TPC-H <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="实例部署-基于单机本地存储" tabindex="-1"><a class="header-anchor" href="#实例部署-基于单机本地存储" aria-hidden="true">#</a> 实例部署：基于单机本地存储</h1><p>以下是基于单机本地存储编译 PolarDB 源码并启动一写多读实例的步骤。</p><p>我们推荐在 Docker 中编译源码并运行示例，从而尽可能减少配置环境的操作。我们提供了一个基于 <a href="https://hub.docker.com/_/centos" target="_blank" rel="noopener noreferrer">CentOS 7 官方 Docker 镜像<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <code>centos:centos7</code> 构建出的 <a href="https://hub.docker.com/r/polardb/polardb_pg_devel/tags" target="_blank" rel="noopener noreferrer">PolarDB 开发镜像<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，里面包含了编译运行 PolarDB 需要的所有依赖。您可以直接使用这个镜像进行实例搭建，也可以自行修改我们在下面提供的 Dockerfile 以满足您的定制需求。</p><p>当然，不使用 Docker 也完全没有问题。我们提供了基于纯净 CentOS 7 操作系统的依赖安装脚本，助您快速完成环境准备。🎉</p><h2 id="安装-docker" tabindex="-1"><a class="header-anchor" href="#安装-docker" aria-hidden="true">#</a> 安装 Docker</h2><div class="custom-container tip"><p class="custom-container-title">提示</p><p>如果不使用 Docker，可跳过本小节。</p></div><p>请参阅 <a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer">Docker 官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 完成不同平台上 Docker 的安装。</p><ul><li>Ubuntu：<a href="https://docs.docker.com/engine/install/ubuntu/" target="_blank" rel="noopener noreferrer">在 Ubuntu 上安装 Docker Engine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Debian：<a href="https://docs.docker.com/engine/install/debian/" target="_blank" rel="noopener noreferrer">在 Debian 上安装 Docker Engine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>CentOS：<a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener noreferrer">在 CentOS 上安装 Docker Engine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>RHEL：<a href="https://docs.docker.com/engine/install/rhel/" target="_blank" rel="noopener noreferrer">在 RHEL 上安装 Docker Engine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Fedora：<a href="https://docs.docker.com/engine/install/fedora/" target="_blank" rel="noopener noreferrer">在 Fedora 上安装 Docker Engine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>macOS（支持 M1 芯片）：<a href="https://docs.docker.com/desktop/mac/install/" target="_blank" rel="noopener noreferrer">在 Mac 上安装 Docker Desktop<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，并建议将内存调整为 4GB</li></ul><h2 id="编译环境准备" tabindex="-1"><a class="header-anchor" href="#编译环境准备" aria-hidden="true">#</a> 编译环境准备</h2><p>以下两种方式任选一种即可：</p><ul><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#%E5%9F%BA%E4%BA%8E-polardb-docker-%E5%BC%80%E5%8F%91%E9%95%9C%E5%83%8F" class="router-link-active router-link-exact-active">基于 PolarDB Docker 开发镜像</a>：无需手动配置环境，较为简单</li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-local-storage.html#%E5%9F%BA%E4%BA%8E-centos-7-%E7%B3%BB%E7%BB%9F%E6%88%96%E5%AE%B9%E5%99%A8" class="router-link-active router-link-exact-active">基于 CentOS 7 系统或容器</a>：适合对开发环境做更多定制</li></ul><h3 id="基于-polardb-docker-开发镜像" tabindex="-1"><a class="header-anchor" href="#基于-polardb-docker-开发镜像" aria-hidden="true">#</a> 基于 PolarDB Docker 开发镜像</h3><p>该方式使您可以在 Docker 容器中编译并部署示例。</p><h4 id="docker-镜像准备" tabindex="-1"><a class="header-anchor" href="#docker-镜像准备" aria-hidden="true">#</a> Docker 镜像准备</h4><p>我们在 DockerHub 上提供了构建完毕的镜像 <a href="https://hub.docker.com/r/polardb/polardb_pg_devel/tags" target="_blank" rel="noopener noreferrer"><code>polardb/polardb_pg_devel:centos7</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 可供直接使用（支持 x86_64 和 ARM 架构）😁。</p><p>另外，我们也提供了构建上述开发镜像的 Dockerfile，从 CentOS 7 官方镜像 <code>centos:centos7</code> 开始构建出一个安装完所有开发和运行时依赖的镜像。您可以根据自己的需要在 Dockerfile 中添加更多依赖。以下是手动构建镜像的 Dockerfile 及方法，如果您决定直接使用 DockerHub 上构建完毕的镜像，则跳过该步骤。</p><details class="custom-container details"><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> centos:centos7</span>

<span class="token instruction"><span class="token keyword">LABEL</span> maintainer=<span class="token string">&quot;mrdrivingduck@gmail.com&quot;</span></span>

<span class="token instruction"><span class="token keyword">CMD</span> bash</span>

<span class="token comment"># avoid missing locale problem</span>
<span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">&#39;s/override_install_langs/# &amp;/&#39;</span> /etc/yum.conf</span>

<span class="token comment"># add EPEL and scl source</span>
<span class="token instruction"><span class="token keyword">RUN</span> rpmkeys --import file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 &amp;&amp; <span class="token operator">\</span>
    yum install -y epel-release centos-release-scl &amp;&amp; <span class="token operator">\</span>
    rpmkeys --import file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7 &amp;&amp; <span class="token operator">\</span>
    rpmkeys --import file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo &amp;&amp; <span class="token operator">\</span>
    yum update -y</span>

<span class="token comment"># GCC and LLVM</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum install -y devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-gdb <span class="token operator">\</span>
                   devtoolset-9-libstdc++-devel devtoolset-9-make &amp;&amp; <span class="token operator">\</span>
    yum install -y llvm-toolset-7.0-llvm-devel llvm-toolset-7.0-clang-devel <span class="token operator">\</span>
                   llvm-toolset-7.0-cmake</span>

<span class="token comment"># dependencies</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum install -y libicu-devel pam-devel readline-devel libxml2-devel <span class="token operator">\</span>
                   libxslt-devel openldap-devel openldap-clients <span class="token operator">\</span>
                   openldap-servers libuuid-devel xerces-c-devel <span class="token operator">\</span>
                   bison flex gettext tcl-devel python-devel perl-IPC-Run <span class="token operator">\</span>
                   perl-Expect perl-Test-Simple perl-DBD-Pg perl-ExtUtils-Embed <span class="token operator">\</span>
                   perl-ExtUtils-MakeMaker zlib-devel krb5-devel <span class="token operator">\</span>
                   krb5-workstation krb5-server protobuf-devel</span>

<span class="token instruction"><span class="token keyword">RUN</span> ln /usr/lib64/perl5/CORE/libperl.so /usr/lib64/libperl.so</span>

<span class="token comment"># tools</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum install -y git lcov psmisc sudo vim</span>

<span class="token comment"># set to empty if GitHub is not barriered</span>
<span class="token instruction"><span class="token keyword">ENV</span> GITHUB_PROXY=https://ghproxy.com/</span>

<span class="token instruction"><span class="token keyword">ENV</span> OPENSSL_VERSION=OpenSSL_1_1_1k</span>

<span class="token comment"># install dependencies from GitHub mirror</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum install -y libaio-devel wget &amp;&amp; <span class="token operator">\</span>
    cd /usr/local &amp;&amp; <span class="token operator">\</span>
    <span class="token comment"># zlog for PFSD</span>
    wget --no-verbose --no-check-certificate <span class="token operator">\</span>
    <span class="token string">&quot;${GITHUB_PROXY}https://github.com/HardySimpson/zlog/archive/refs/tags/1.2.14.tar.gz&quot;</span> &amp;&amp; <span class="token operator">\</span>
    <span class="token comment"># PFSD</span>
    wget --no-verbose --no-check-certificate <span class="token operator">\</span>
    <span class="token string">&quot;${GITHUB_PROXY}https://github.com/ApsaraDB/PolarDB-FileSystem/archive/refs/tags/pfsd4pg-release-1.2.41-20211018.tar.gz&quot;</span> &amp;&amp; <span class="token operator">\</span>
    <span class="token comment"># OpenSSL 1.1.1</span>
    wget --no-verbose --no-check-certificate <span class="token operator">\</span>
    <span class="token string">&quot;${GITHUB_PROXY}https://github.com/openssl/openssl/archive/refs/tags/${OPENSSL_VERSION}.tar.gz&quot;</span> &amp;&amp; <span class="token operator">\</span>
    <span class="token comment"># enable build tools</span>
    echo <span class="token string">&quot;source /opt/rh/devtoolset-9/enable&quot;</span> &gt;&gt; /etc/bashrc &amp;&amp; <span class="token operator">\</span>
    echo <span class="token string">&quot;source /opt/rh/llvm-toolset-7.0/enable&quot;</span> &gt;&gt; /etc/bashrc &amp;&amp; <span class="token operator">\</span>
    source /etc/bashrc &amp;&amp; <span class="token operator">\</span>
    <span class="token comment"># unzip and install zlog</span>
    tar -zxf 1.2.14.tar.gz &amp;&amp; <span class="token operator">\</span>
    cd zlog-1.2.14 &amp;&amp; <span class="token operator">\</span>
    make &amp;&amp; make install &amp;&amp; <span class="token operator">\</span>
    cd .. &amp;&amp; <span class="token operator">\</span>
    rm 1.2.14.tar.gz &amp;&amp; <span class="token operator">\</span>
    rm -rf zlog-1.2.14 &amp;&amp; <span class="token operator">\</span>
    <span class="token comment"># unzip and install PFSD</span>
    tar -zxf pfsd4pg-release-1.2.41-20211018.tar.gz &amp;&amp; <span class="token operator">\</span>
    cd PolarDB-FileSystem-pfsd4pg-release-1.2.41-20211018 &amp;&amp; <span class="token operator">\</span>
    ./autobuild.sh &amp;&amp; ./install.sh &amp;&amp; <span class="token operator">\</span>
    cd .. &amp;&amp; <span class="token operator">\</span>
    rm pfsd4pg-release-1.2.41-20211018.tar.gz &amp;&amp; <span class="token operator">\</span>
    rm -rf PolarDB-FileSystem-pfsd4pg-release-1.2.41-20211018 &amp;&amp; <span class="token operator">\</span>
    <span class="token comment"># unzip and install OpenSSL 1.1.1</span>
    tar -zxf <span class="token variable">$OPENSSL_VERSION</span>.tar.gz &amp;&amp; <span class="token operator">\</span>
    cd /usr/local/openssl-<span class="token variable">$OPENSSL_VERSION</span> &amp;&amp; <span class="token operator">\</span>
    ./config --prefix=/usr/local/openssl &amp;&amp; make -j64 &amp;&amp; make install &amp;&amp; <span class="token operator">\</span>
    cp /usr/local/openssl/lib/libcrypto.so.1.1 /usr/lib64/ &amp;&amp; <span class="token operator">\</span>
    cp /usr/local/openssl/lib/libssl.so.1.1 /usr/lib64/ &amp;&amp; <span class="token operator">\</span>
    cp -r /usr/local/openssl/include/openssl /usr/include/ &amp;&amp; <span class="token operator">\</span>
    ln -sf /usr/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so &amp;&amp; <span class="token operator">\</span>
    ln -sf /usr/lib64/libssl.so.1.1 /usr/lib64/libssl.so &amp;&amp; <span class="token operator">\</span>
    rm -f /usr/local/<span class="token variable">$OPENSSL_VERSION</span>.tar.gz &amp;&amp; <span class="token operator">\</span>
    rm -rf /usr/local/openssl-<span class="token variable">$OPENSSL_VERSION</span></span>

<span class="token comment"># create default user</span>
<span class="token instruction"><span class="token keyword">ENV</span> USER_NAME=postgres</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">&quot;create default user&quot;</span> &amp;&amp; <span class="token operator">\</span>
    groupadd -r <span class="token variable">$USER_NAME</span> &amp;&amp; useradd -g <span class="token variable">$USER_NAME</span> <span class="token variable">$USER_NAME</span> -p <span class="token string">&#39;&#39;</span> &amp;&amp; <span class="token operator">\</span>
    usermod -aG wheel <span class="token variable">$USER_NAME</span></span>

<span class="token instruction"><span class="token keyword">WORKDIR</span> /home/<span class="token variable">$USER_NAME</span></span>

<span class="token comment"># modify conf</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">&quot;modify conf&quot;</span> &amp;&amp; <span class="token operator">\</span>
    mkdir -p /run/pfs &amp;&amp; chown <span class="token variable">$USER_NAME</span> /run/pfs &amp;&amp; <span class="token operator">\</span>
    mkdir -p /var/log/pfs &amp;&amp; chown <span class="token variable">$USER_NAME</span> /var/log/pfs &amp;&amp; <span class="token operator">\</span>
    echo <span class="token string">&quot;ulimit -c unlimited&quot;</span> &gt;&gt; /home/postgres/.bashrc &amp;&amp; <span class="token operator">\</span>
    echo <span class="token string">&quot;export PATH=/home/postgres/tmp_basedir_polardb_pg_1100_bld/bin:\$PATH&quot;</span> &gt;&gt; /home/postgres/.bashrc &amp;&amp; <span class="token operator">\</span>
    echo <span class="token string">&quot;alias pg=&#39;psql -h /home/postgres/tmp_master_dir_polardb_pg_1100_bld/&#39;&quot;</span> &gt;&gt; /home/postgres/.bashrc &amp;&amp; <span class="token operator">\</span>
    rm /etc/localtime &amp;&amp; <span class="token operator">\</span>
    cp /usr/share/zoneinfo/UTC /etc/localtime &amp;&amp; <span class="token operator">\</span>
    sed -i <span class="token string">&#39;s/4096/unlimited/g&#39;</span> /etc/security/limits.d/20-nproc.conf &amp;&amp; <span class="token operator">\</span>
    sed -i <span class="token string">&#39;s/vim/vi/g&#39;</span> /root/.bashrc</span>

<span class="token instruction"><span class="token keyword">USER</span> <span class="token variable">$USER_NAME</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div></details><p>将上述内容复制到一个文件内（假设文件名为 <code>Dockerfile-PolarDB</code>）后，使用如下命令构建镜像：</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>💡 请在下面的高亮行中按需替换 <code>&lt;image_name&gt;</code> 内的 Docker 镜像名称</p></div><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">docker</span> build --network<span class="token operator">=</span>host <span class="token punctuation">\</span>
    -t <span class="token operator">&lt;</span>image_name<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -f Dockerfile-PolarDB <span class="token builtin class-name">.</span>
</code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br></div></div><h4 id="代码下载" tabindex="-1"><a class="header-anchor" href="#代码下载" aria-hidden="true">#</a> 代码下载</h4><p>PolarDB for PostgreSQL 的代码托管于 <a href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL" target="_blank" rel="noopener noreferrer">GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 上，稳定分支为 <code>POLARDB_11_STABLE</code>。</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">git</span> clone -b POLARDB_11_STABLE https://github.com/ApsaraDB/PolarDB-for-PostgreSQL.git
</code></pre></div><h4 id="启动-docker-容器" tabindex="-1"><a class="header-anchor" href="#启动-docker-容器" aria-hidden="true">#</a> 启动 Docker 容器</h4><div class="custom-container tip"><p class="custom-container-title">提示</p><p>💡 请在下面的高亮行中按需替换 <code>&lt;&gt;</code> 的部分：</p><ol><li>PolarDB for PostgreSQL 的源码路径</li><li>将要启动的 Docker 容器名称</li><li>自行构建或 DockerHub 上的 PolarDB 开发镜像名称</li></ol></div><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">docker</span> run -it <span class="token punctuation">\</span>
    -v <span class="token operator">&lt;</span>src_to_polardb<span class="token operator">&gt;</span>:/home/postgres/PolarDB-for-PostgreSQL <span class="token punctuation">\</span>
    --cap-add<span class="token operator">=</span>SYS_PTRACE --privileged<span class="token operator">=</span>true <span class="token punctuation">\</span>
    --name <span class="token operator">&lt;</span>container_name<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    <span class="token operator">&lt;</span>image_name<span class="token operator">&gt;</span> <span class="token function">bash</span>
</code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br><div class="highlight-line"> </div><div class="highlight-line"> </div></div></div><p>镜像构建过程中已经创建了一个 <code>postgres:postgres</code> 用户，从该镜像运行的容器将直接使用这个用户。容器启动后，后续直接进入正在运行的容器中：</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it <span class="token punctuation">\</span>
    --env <span class="token assign-left variable"><span class="token environment constant">COLUMNS</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>tput cols<span class="token variable">`</span></span> <span class="token punctuation">\</span>
    --env <span class="token assign-left variable"><span class="token environment constant">LINES</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>tput lines<span class="token variable">`</span></span> <span class="token punctuation">\</span>
    <span class="token operator">&lt;</span>container_name<span class="token operator">&gt;</span> <span class="token function">bash</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div></div></div><p>通过 bash 进入容器后，进入源码目录，为用户 <code>postgres</code> 获取源代码目录权限，然后编译实例：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /home/postgres/PolarDB-for-PostgreSQL
<span class="token function">sudo</span> <span class="token function">chown</span> -R postgres:postgres ./
./polardb_build.sh
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>部署完成后，进行简单的实例检查，确保部署正确：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\</span>
    -p <span class="token number">5432</span> -h <span class="token number">127.0</span>.0.1 -c <span class="token string">&#39;select version();&#39;</span>
            version
--------------------------------
 PostgreSQL <span class="token number">11.9</span> <span class="token punctuation">(</span>POLARDB <span class="token number">11.9</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="基于-centos-7-系统或容器" tabindex="-1"><a class="header-anchor" href="#基于-centos-7-系统或容器" aria-hidden="true">#</a> 基于 CentOS 7 系统或容器</h3><p>该方式假设您从一台具有 root 权限的干净的 CentOS 7 操作系统上从零开始，可以是：</p><ul><li>安装 CentOS 7 的物理机/虚拟机</li><li>从 CentOS 7 官方 Docker 镜像 <code>centos:centos7</code> 上启动的 Docker 容器</li></ul><h4 id="建立非-root-用户" tabindex="-1"><a class="header-anchor" href="#建立非-root-用户" aria-hidden="true">#</a> 建立非 root 用户</h4><p>PolarDB for PostgreSQL 需要以非 root 用户运行。以下步骤能够帮助您创建一个名为 <code>postgres</code> 的用户组和一个名为 <code>postgres</code> 的用户。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>如果您已经有了一个非 root 用户，但名称不是 <code>postgres:postgres</code>，可以忽略该步骤；但请注意在后续示例步骤中将命令中用户相关的信息替换为您自己的用户组名与用户名。</p></div><p>下面的命令能够创建用户组 <code>postgres</code> 和用户 <code>postgres</code>，并为该用户赋予 sudo 和工作目录的权限。需要以 root 用户执行这些命令。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># install sudo</span>
yum <span class="token function">install</span> -y <span class="token function">sudo</span>

<span class="token comment"># create user and group</span>
<span class="token function">groupadd</span> -r postgres
<span class="token function">useradd</span> -m -g postgres postgres -p <span class="token string">&#39;&#39;</span>
<span class="token function">usermod</span> -aG wheel postgres

<span class="token comment"># make postgres as sudoer</span>
<span class="token function">chmod</span> u+w /etc/sudoers
<span class="token builtin class-name">echo</span> <span class="token string">&#39;postgres ALL=(ALL) NOPASSWD: ALL&#39;</span> <span class="token operator">&gt;&gt;</span> /etc/sudoers
<span class="token function">chmod</span> u-w /etc/sudoers

<span class="token comment"># grant access to home directory</span>
<span class="token function">chown</span> -R postgres:postgres /home/postgres/
<span class="token builtin class-name">echo</span> <span class="token string">&#39;source /etc/bashrc&#39;</span> <span class="token operator">&gt;&gt;</span> /home/postgres/.bashrc
<span class="token comment"># for su postgres</span>
<span class="token function">sed</span> -i <span class="token string">&#39;s/4096/unlimited/g&#39;</span> /etc/security/limits.d/20-nproc.conf
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>接下来，切换到 <code>postgres</code> 用户，就可以进行后续的步骤了：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">su</span> postgres
<span class="token builtin class-name">source</span> /etc/bashrc
<span class="token builtin class-name">cd</span> ~
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="下载-polardb-源代码" tabindex="-1"><a class="header-anchor" href="#下载-polardb-源代码" aria-hidden="true">#</a> 下载 PolarDB 源代码</h4><p>PolarDB for PostgreSQL 的代码托管于 <a href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL" target="_blank" rel="noopener noreferrer">GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 上，稳定分支为 <code>POLARDB_11_STABLE</code>。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y <span class="token function">git</span>
<span class="token function">git</span> clone -b POLARDB_11_STABLE https://github.com/ApsaraDB/PolarDB-for-PostgreSQL.git
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="依赖安装" tabindex="-1"><a class="header-anchor" href="#依赖安装" aria-hidden="true">#</a> 依赖安装</h4><p>使用 <code>sudo</code> 执行源代码根目录下的依赖安装脚本 <code>install_dependencies.sh</code> 完成所有的依赖安装。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> PolarDB-for-PostgreSQL
<span class="token function">sudo</span> ./install_dependencies.sh
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="编译部署" tabindex="-1"><a class="header-anchor" href="#编译部署" aria-hidden="true">#</a> 编译部署</h4><p>依赖安装完毕后，刷新用户配置，开始编译部署：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">source</span> /etc/bashrc
./polardb_build.sh
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>部署完成后，进行简单的实例检查：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\</span>
    -p <span class="token number">5432</span> -h <span class="token number">127.0</span>.0.1 -c <span class="token string">&#39;select version();&#39;</span>
            version
--------------------------------
 PostgreSQL <span class="token number">11.9</span> <span class="token punctuation">(</span>POLARDB <span class="token number">11.9</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="编译实例类型" tabindex="-1"><a class="header-anchor" href="#编译实例类型" aria-hidden="true">#</a> 编译实例类型</h2><h3 id="本地单节点实例" tabindex="-1"><a class="header-anchor" href="#本地单节点实例" aria-hidden="true">#</a> 本地单节点实例</h3><ul><li>1 个主节点（运行于 <code>5432</code> 端口）</li></ul><div class="language-bash ext-sh"><pre class="language-bash"><code>./polardb_build.sh
</code></pre></div><h3 id="本地多节点实例" tabindex="-1"><a class="header-anchor" href="#本地多节点实例" aria-hidden="true">#</a> 本地多节点实例</h3><ul><li>1 个主节点（运行于 <code>5432</code> 端口）</li><li>1 个只读节点（运行于 <code>5433</code> 端口）</li></ul><div class="language-bash ext-sh"><pre class="language-bash"><code>./polardb_build.sh --withrep --repnum<span class="token operator">=</span><span class="token number">1</span>
</code></pre></div><h3 id="本地多节点带备库实例" tabindex="-1"><a class="header-anchor" href="#本地多节点带备库实例" aria-hidden="true">#</a> 本地多节点带备库实例</h3><ul><li>1 个主节点（运行于 <code>5432</code> 端口）</li><li>1 个只读节点（运行于 <code>5433</code> 端口）</li><li>1 个备库节点（运行于 <code>5434</code> 端口）</li></ul><div class="language-bash ext-sh"><pre class="language-bash"><code>./polardb_build.sh --withrep --repnum<span class="token operator">=</span><span class="token number">1</span> --withstandby
</code></pre></div><h3 id="本地多节点-htap-实例" tabindex="-1"><a class="header-anchor" href="#本地多节点-htap-实例" aria-hidden="true">#</a> 本地多节点 HTAP 实例</h3><ul><li>1 个主节点（运行于 <code>5432</code> 端口）</li><li>2 个只读节点（运行于 <code>5433</code> / <code>5434</code> 端口）</li></ul><div class="language-bash ext-sh"><pre class="language-bash"><code>./polardb_build.sh --initpx
</code></pre></div><h2 id="实例回归测试" tabindex="-1"><a class="header-anchor" href="#实例回归测试" aria-hidden="true">#</a> 实例回归测试</h2><p>普通实例回归测试：</p><div class="language-bash ext-sh"><pre class="language-bash"><code>./polardb_build.sh -r -e -r-external -r-contrib -r-pl --withrep --with-tde
</code></pre></div><p>HTAP 实例回归测试：</p><div class="language-bash ext-sh"><pre class="language-bash"><code>./polardb_build.sh -r-px -e -r-external -r-contrib -r-pl --with-tde
</code></pre></div><p>分布式实例回归测试：</p><div class="language-bash ext-sh"><pre class="language-bash"><code>./polardb_build.sh -r -e -r-external -r-contrib -r-pl --with-tde --with-dma
</code></pre></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL/edit/main/zh/guide/deploy-on-local-storage.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 562655624@qq.com">棠羽</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: zunbao.fengzb@alibaba-inc.com">zunbao.fengzb</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: zunbao.fengzb@alibaba-inc.com">北侠</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-cloud.html" class="" aria-label="实例部署：基于阿里巴巴云服务"><!--[--><!--]--> 实例部署：基于阿里巴巴云服务 <!--[--><!--]--></a></span><span class="next"><a href="/PolarDB-for-PostgreSQL/zh/guide/deploy-on-nbd-shared-storage.html" class="" aria-label="实例部署：基于 NBD 共享存储"><!--[--><!--]--> 实例部署：基于 NBD 共享存储 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/PolarDB-for-PostgreSQL/assets/app.9be17b95.js" defer></script>
  </body>
</html>
